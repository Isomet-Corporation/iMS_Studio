<Window x:Class="iMS_Studio.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:iMS_Studio"
        xmlns:xctk="clr-namespace:Xceed.Wpf.Toolkit;assembly=DotNetProjects.Wpf.Extended.Toolkit"
        xmlns:s="clr-namespace:System;assembly=mscorlib"
        xmlns:v="clr-namespace:iMS_Studio.View"
        xmlns:pane="clr-namespace:iMS_Studio.View.Pane"
        xmlns:vm="clr-namespace:iMS_Studio.ViewModel"        
        xmlns:dock="clr-namespace:AvalonDock;assembly=AvalonDock"
        xmlns:docklayout="clr-namespace:AvalonDock.Layout;assembly=AvalonDock"
        xmlns:dockctrl="clr-namespace:AvalonDock.Controls;assembly=AvalonDock"
        xmlns:dockconv="clr-namespace:AvalonDock.Converters;assembly=AvalonDock"
        xmlns:theme="clr-namespace:AvalonDock.Themes;assembly=AvalonDock.Themes.Metro"
        xmlns:AVBehav="clr-namespace:iMS_Studio.View.Behaviour"
        Title="{Binding WindowName}" Icon="..\resources\Images\Isomet icon 128 128.ico" Height="750" Width="1350"
            Closing="Window_Closing" MouseUp="Window_MouseUp" WindowStartupLocation="CenterOwner"
            WindowState="Maximized">
    <Window.Resources>
        <dockconv:BoolToVisibilityConverter x:Key="AvalonBoolToVisibilityConverter"/>
        <Style x:Key="ImageEnabled" TargetType="Image">
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.25"></Setter>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Menu Grid.Row="0" DataContext="{Binding MenuViewModel}" ItemsSource="{Binding Items}">
            <Menu.Resources>
                <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource {x:Type MenuItem}}">
                    <Setter Property="Command" Value="{Binding Command}" />
                    <Setter Property="Header" Value="{Binding Header}" />
                    <Setter Property="IsCheckable" Value="{Binding IsCheckable}" />
                    <Setter Property="IsChecked" Value="{Binding IsChecked}" />
                    <Setter Property="IsEnabled" Value="{Binding IsEnabled}" />
                </Style>
                <HierarchicalDataTemplate DataType="{x:Type vm:MenuItemViewModel}" ItemsSource="{Binding Items}" />
            </Menu.Resources>
        </Menu>

        <ToolBarTray Grid.Row="1" x:Name="toolBar">
            <ToolBar>
                <Button Command="New" ToolTip="New Image Project" Height="32">
                    <Image Source="..\resources\Images\file_yellow_empty_new.png" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="Open" ToolTip="Open Image Project" Height="32">
                    <Image Source="..\resources\Images\directory_open.png" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="Save" ToolTip="Save Image Project" Height="32">
                    <Image Source="..\resources\Images\floppy_35inch_blue.png" Style="{StaticResource ImageEnabled}" />
                </Button>
            </ToolBar>
            <ToolBar>
                <Button Command="Undo" ToolTip="Undo" Height="32">
                    <Image Source="..\resources\Images\undo_blue.png" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="Redo" ToolTip="Redo" Height="32">
                    <Image Source="..\resources\Images\redo_blue.png" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="Cut" ToolTip="Cut selection" Height="32">
                    <Image Source="..\resources\Images\scissors.png" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="Copy" ToolTip="Copy selection" Height="32">
                    <Image Source="..\resources\Images\copy.png" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="Paste" ToolTip="Paste selection" Height="32">
                    <Image Source="..\resources\Images\paste.png" Style="{StaticResource ImageEnabled}" />
                </Button>
            </ToolBar>
            <ToolBar>
                <Button Command="{Binding Path=AddNewImageGroupCommand}" ToolTip="New Image Group" Height="32">
                    <Image Source="..\resources\Images\file_yellow_hierarchy1_expanded_add.png" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="{Binding Path=AddNewImageCommand}" ToolTip="New Image" Height="32">
                    <Image Source="..\resources\Images\file_yellow_empty_add.png" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Click="AddPresetButton_Click"  x:Name="AddPresetButton" ToolTip="New Item" Height="32" Width="12">
                    <Image Source="..\resources\Images\arrow_plain_blue_S.png" Margin="0,15,0,0" />
                    <Button.ContextMenu>
                        <ContextMenu DataContext="{x:Reference toolBar}">
                            <MenuItem Header="New Image" Command="{Binding Path=DataContext.AddNewImageCommand}"/>
                            <MenuItem Header="New Compensation Function" Command="{Binding Path=DataContext.AddNewCompensationFunctionCommand}"/>
                            <MenuItem Header="New Tone Buffer" Command="{Binding Path=DataContext.AddNewToneBufferCommand}"/>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
                <Button Command="{Binding Path=DeleteAnySelectedCommand}" ToolTip="Delete Item" Height="32">
                    <Image Source="..\resources\Images\delete_red.png" Style="{StaticResource ImageEnabled}" />
                </Button>
            </ToolBar>
            <ToolBar>
                <Button Command="{Binding Path=PlayImageCommand}" ToolTip="Play Image" Height="32">
                    <Image Source="..\resources\Images\play-normal-icon-30px.png" Stretch="UniformToFill" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="Play" ToolTip="Play Image Sequence" Height="32">
                    <Image Source="..\resources\Images\step-forward-normal-blue-icon-30px.png" Stretch="UniformToFill" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="{Binding Path=StopImageCommand}" ToolTip="Stop Image Playback" Height="32">
                    <Image Source="..\resources\Images\stop-normal-blue-icon-30px.png" Stretch="UniformToFill" Style="{StaticResource ImageEnabled}" />
                </Button>
                <Button Command="{Binding Path=ForceStopImageCommand}" ToolTip="Stop Immediately" Height="32">
                    <Image Source="..\resources\Images\stop-normal-red-icon-30px.png" Stretch="UniformToFill" Style="{StaticResource ImageEnabled}" />
                </Button>
            </ToolBar>
            <ToolBar>
                <Button Command="{Binding Path=EmergencyStopCommand}" ToolTip="Emergency Stop" Height="32">
                    <Image Source="..\resources\Images\Stop_Sign_30px.png" Stretch="UniformToFill" />
                </Button>
            </ToolBar>
        </ToolBarTray>

        <dock:DockingManager Grid.Row="2"
                         DataContext="{Binding DockManagerViewModel}"
                         DocumentsSource="{Binding Documents}"
                         AnchorablesSource="{Binding Anchorables}" Background="#7FE7F3F3"
                         AVBehav:AvalonDockLayoutSerializer.LoadLayoutCommand="{Binding ADLayout.LoadLayoutCommand}"
                         AVBehav:AvalonDockLayoutSerializer.SaveLayoutCommand="{Binding ADLayout.SaveLayoutCommand}">

            <dock:DockingManager.Theme>
                <theme:MetroTheme/>
            </dock:DockingManager.Theme>

            <dock:DockingManager.LayoutUpdateStrategy>
                <pane:LayoutInitializer/>
            </dock:DockingManager.LayoutUpdateStrategy>

            <dock:DockingManager.Resources>

                <!-- add views for specific ViewModels -->
                <DataTemplate DataType="{x:Type vm:ImageDockWindowViewModel}">
                    <v:ImageDockWindowView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:SequenceDockWindowViewModel}">
                    <v:SequenceDockWindowView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:CompensationTableDockWindowViewModel}">
                    <v:CompensationTableDockWindowView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:ToneBufferDockWindowViewModel}">
                    <v:ToneBufferDockWindowView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:ImageProjectTreeViewModel}">
                    <v:ImageProjectTreeView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:SignalPathViewModel}">
                    <v:SignalPathView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:CalibrationViewModel}">
                    <v:CalibrationView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:EnhancedToneViewModel}">
                    <v:EnhancedToneView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:PlayConfigurationViewModel}">
                    <v:PlayConfigurationView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:SyncDataViewModel}">
                    <v:SyncDataView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:SysFuncViewModel}">
                    <v:SysFuncView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:CompensationViewModel}">
                    <v:CompensationView />
                </DataTemplate>
                <DataTemplate DataType="{x:Type vm:HWServerConsoleViewModel}">
                    <v:HWServerConsole />
                </DataTemplate>

            </dock:DockingManager.Resources>

            <dock:DockingManager.LayoutItemContainerStyle>
                <!-- you can add additional bindings from the layoutitem to the DockWindowViewModel -->
                <Style TargetType="{x:Type dockctrl:LayoutItem}" >
                    <Setter Property="IsSelected" Value="{Binding Model.IsSelected, Mode=TwoWay}" />
                    <Setter Property="Title" Value="{Binding Model.Title}" />
                    <Setter Property="CloseCommand" Value="{Binding Model.CloseCommand}" />
                    <Setter Property="ContentId" Value="{Binding Model.ContentId}"/>
                    <Setter Property="CanClose" Value="{Binding Model.CanClose}" />
                    <Setter Property="Visibility" Value="{Binding Model.IsVisible, ConverterParameter={x:Static Visibility.Hidden}, Converter={StaticResource AvalonBoolToVisibilityConverter}, Mode=TwoWay}"/>
                </Style>
            </dock:DockingManager.LayoutItemContainerStyle>

           <docklayout:LayoutRoot>
                <docklayout:LayoutPanel Orientation="Horizontal">
                    <docklayout:LayoutAnchorablePane Name="AnchorablesPaneLeft" DockWidth="240" />
                    <docklayout:LayoutDocumentPane/>
<!--                    <dock:LayoutAnchorablePane Name="AnchorablesPaneRight" DockWidth="240" /> -->
                </docklayout:LayoutPanel>
                <docklayout:LayoutRoot.RightSide>
                    <docklayout:LayoutAnchorSide>
                        <docklayout:LayoutAnchorGroup />
                        <docklayout:LayoutAnchorGroup />
                        <docklayout:LayoutAnchorGroup />
                        <docklayout:LayoutAnchorGroup />
                        <docklayout:LayoutAnchorGroup />
                        <docklayout:LayoutAnchorGroup />
                    </docklayout:LayoutAnchorSide>
                </docklayout:LayoutRoot.RightSide>
                <docklayout:LayoutRoot.BottomSide>
                    <docklayout:LayoutAnchorSide>
                        <docklayout:LayoutAnchorGroup />
                    </docklayout:LayoutAnchorSide>
                </docklayout:LayoutRoot.BottomSide>
            </docklayout:LayoutRoot>

        </dock:DockingManager>

        <StatusBar Grid.Row="3">
            <StatusBar.ItemsPanel>
                <ItemsPanelTemplate>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                </ItemsPanelTemplate>
            </StatusBar.ItemsPanel>
            <StatusBarItem BorderThickness="1">
                <TextBlock Name="lblStatusBar" Text="{Binding StatusBarText}"/>
            </StatusBarItem>
            <Separator Grid.Column="1"/>
            <StatusBarItem Grid.Column="2" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch">
                <ProgressBar IsIndeterminate="{Binding ImageProgressInDeterminate}" Value="{Binding ImageProgress}" Minimum="0" Maximum="{Binding ImageLength}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>